trigger:
  - master
  - feature/*
pr: none

variables:
  # Azure Resource Manager connection created during pipeline creation
  azureSubscription: 'c8a57e97-c12f-4a1a-bf49-5f21b3cad8b2'
  vmImageName: 'ubuntu-latest'
  buildConfiguration: 'Release'
  srcWorkingDir: './src'
  terraformWorkingDir: './terraform'

stages:
- stage: Build
  displayName: Build stage
  jobs:
  - job: Build
    displayName: Build
    pool:
      vmImage: $(vmImageName)

    steps:
      - script: dotnet build --configuration $(buildConfiguration)
        workingDirectory: $(srcWorkingDir)
        displayName: 'dotnet build'

      - task: DotNetCoreCLI@2
        displayName: 'dotnet publish'
        inputs:
          command: publish
          workingDirectory: $(srcWorkingDir)
          publishWebProjects: True
          arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'
          zipAfterPublish: True